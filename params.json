{"name":"Razor Chef Cookbook","tagline":"Chef cookbook to install and manage Razor. An LWRP is provided to manage OS and micro kernel images.","body":"[![Build Status](https://travis-ci.org/bbg-cookbooks/razor.png?branch=master)](https://travis-ci.org/bbg-cookbooks/razor)\r\n\r\n* Website: http://bbg-cookbooks.github.io/razor\r\n* Opscode Community Site: http://community.opscode.com/cookbooks/razor\r\n* Source Code: https://github.com/bbg-cookbooks/razor\r\n\r\n## <a name=\"description\"></a> Description\r\n\r\nChef cookbook to install and manage [Razor][razor_site], a power control,\r\nprovisioning, and management application designed to deploy both bare-metal\r\nand virtual computer resources. An LWRP is provided to manage OS and\r\nmicro kernel images.\r\n\r\n## <a name=\"usage\"></a> Usage\r\n\r\nInclude `recipe[razor]` in your run\\_list to install the Razor service and its\r\ndependencies. If you wish to modify or alter the details of the installation\r\n(i.e. using a different mongodb cookbook, installing nodejs from source, etc.),\r\nthen compose a custom run\\_list of the child recipes described\r\n[below](#recipes).\r\n\r\n## <a name=\"requirements\"></a> Requirements\r\n\r\n### <a name=\"requirements-chef\"></a> Chef\r\n\r\nTested on 10.14.4 and 11.2 but newer and older version should work just fine. File an\r\n[issue][issues] if this isn't the case.\r\n\r\n### <a name=\"requirements-platform\"></a> Platform\r\n\r\nThe following platforms have been tested with this cookbook, meaning that the\r\nrecipes run on these platforms without error:\r\n\r\n* ubuntu (10.04/12.04/12.10)\r\n\r\n### <a name=\"requirements-cookbooks\"></a> Cookbooks\r\n\r\nThis cookbook depends on the following external cookbooks:\r\n\r\n* [build-essential][build_essential_cb]\r\n* [git][git_cb]\r\n* [tftp][tftp_cb]\r\n* [mongodb][mongodb_cb]\r\n* [postgresql][postgresql_cb]\r\n* [nodejs][nodejs_cb]\r\n\r\n## <a name=\"installation\"></a> Installation\r\n\r\nDepending on the situation and use case there are several ways to install\r\nthis cookbook. All the methods listed below assume a tagged version release\r\nis the target, but omit the tags to get the head of development. A valid\r\nChef repository structure like the [Opscode repo][chef_repo] is also assumed.\r\n\r\n### <a name=\"installation-community\"></a> From the Opscode Community Site\r\n\r\nTo install this cookbook from the Opscode Community Site, use the *knife*\r\ncommand:\r\n\r\n    knife cookbook site install razor\r\n\r\n### <a name=\"installation-berkshelf\"></a> Using Berkshelf\r\n\r\n[Berkshelf][berkshelf] is a cookbook dependency manager and development\r\nworkflow assistant. To install Berkshelf:\r\n\r\n    cd chef-repo\r\n    gem install berkshelf\r\n    berks init\r\n\r\nTo use the Opscode Community Site version:\r\n\r\n    echo \"cookbook 'razor'\" >> Berksfile\r\n    berks install\r\n\r\nOr to reference the GitHub version:\r\n\r\n    repo=\"bbg-cookbooks/razor\"\r\n    latest_release=$(curl -s https://api.github.com/repos/$repo/git/refs/tags \\\r\n    | ruby -rjson -e '\r\n      j = JSON.parse(STDIN.read);\r\n      puts j.map { |t| t[\"ref\"].split(\"/\").last }.sort.last\r\n    ')\r\n    cat >> Berksfile <<END_OF_BERKSFILE\r\n    cookbook 'razor',\r\n      :git => 'git://github.com/$repo.git', :branch => '$latest_release'\r\n    END_OF_BERKSFILE\r\n    berks install\r\n\r\n### <a name=\"installation-librarian\"></a> Using Librarian-Chef\r\n\r\n[Librarian-Chef][librarian] is a bundler for your Chef cookbooks.\r\nTo install Librarian-Chef:\r\n\r\n    cd chef-repo\r\n    gem install librarian\r\n    librarian-chef init\r\n\r\nTo use the Opscode Community Site version:\r\n\r\n    echo \"cookbook 'razor'\" >> Cheffile\r\n    librarian-chef install\r\n\r\nOr to reference the GitHub version:\r\n\r\n    repo=\"bbg-cookbooks/razor\"\r\n    latest_release=$(curl -s https://api.github.com/repos/$repo/git/refs/tags \\\r\n    | ruby -rjson -e '\r\n      j = JSON.parse(STDIN.read);\r\n      puts j.map { |t| t[\"ref\"].split(\"/\").last }.sort.last\r\n    ')\r\n    cat >> Cheffile <<END_OF_CHEFFILE\r\n    cookbook 'razor',\r\n      :git => 'git://github.com/$repo.git', :ref => '$latest_release'\r\n    END_OF_CHEFFILE\r\n    librarian-chef install\r\n\r\n## <a name=\"recipes\"></a> Recipes\r\n\r\n### <a name=\"recipes-default\"></a> default\r\n\r\nInstalls the full Razor stack with all dependencies.\r\n\r\nMost users will want to use this recipe.\r\n\r\n### <a name=\"recipes-tftp\"></a> \\_tftp\r\n\r\nInstalls a tftp server. This recipe is included in the\r\n[default](#recipes-default) recipe.\r\n\r\n### <a name=\"recipes-tftp-files\"></a> \\_tftp_files\r\n\r\nInstalls files and configuration needed for PXE booting and Razor\r\nbootstraping. This recipe is included in the [default](#recipes-default)\r\nrecipe.\r\n\r\n### <a name=\"recipes-mongodb\"></a> \\_mongodb\r\n\r\nInstalls a MongoDB server (from packages) if the `\"mongo\"` persistance mode is\r\nselected and the `mongo/local_server` attribute is set to a truthy value\r\n(otherwise the recipe is effectively skipped). This recipe is included in the\r\n[default](#recipes-default) recipe.\r\n\r\n### <a name=\"recipes-postgresql\"></a> \\_postgresql\r\n\r\nInstalls a PostgreSQL server if the `\"postgres\"` persistent mode is selected\r\nand the `postgres/local_server` attribute is set to a truthy value. Otherwise\r\nthe PostgreSQL client libraries are installed.  This recipe is included in the\r\n[default](#recipes-default) recipe.\r\n\r\n### <a name=\"recipes-nodejs\"></a> \\_nodejs\r\n\r\nInstalls Node.js and npm (from packages). This recipe is included in the\r\n[default](#recipes-default) recipe.\r\n\r\n### <a name=\"recipes-ruby-from-package\"></a> \\_ruby_from_package\r\n\r\nInstalls Ruby (from system packages) and the Bundler gem. This recipe is\r\nincluded in the [default](#recipes-default) recipe.\r\n\r\n### <a name=\"recipes-rubygems-from-source\"></a> \\_rubygems_from_source\r\n\r\nInstalls Rubygems from source on older Debian/Ubuntu platforms that ship a\r\ncrippled Rubygems package. This recipe is included in the\r\n[ruby_from_package](#recipes-ruby-from-package) recipe and will only be used\r\non Ubuntu 10.04 nodes.\r\n\r\n### <a name=\"recipes-app\"></a> \\_app\r\n\r\nInstalls and configures the Razor codebase and service. This recipe is\r\nincluded in the [default](#recipes-default) recipe.\r\n\r\n### <a name=\"recipes-add-images\"></a> \\_add_images\r\n\r\nInstalls images in the Razor service (driven off the `images` attribute). This\r\nrecipe is included in the [default](#recipes-default) recipe.\r\n\r\n## <a name=\"attributes\"></a> Attributes\r\n\r\n### <a name=\"attributes-bind-address\"></a> bind_address\r\n\r\nIP address to which the Razor web services are bound.\r\n\r\nThe default is set to `node['ipaddress']`.\r\n\r\n### <a name=\"attributes-checkin-interval\"></a> checkin_interval\r\n\r\nThe micro kernel checkin interval in seconds.\r\n\r\nThe default is `60`.\r\n\r\n### <a name=\"attributes-persist-mode\"></a> persist_mode\r\n\r\nThe persistence mode that Razor will use. Currently the two supported values are `\"mongo\"` and `\"postgres\"`.\r\n\r\nThe default is `\"mongo\"`.\r\n\r\n**Note:** The is some upstream Razor code changes needed to support PostgreSQL\r\nauthentication via a username and password. In the meantime, your mileage may\r\nvary when using the `\"postgres\"` persistence mode.\r\n\r\n### <a name=\"attributes-persist-host\"></a> persist_host\r\n\r\nThe hostname or IP adrress of the persistence service.\r\n\r\nThe default is `\"127.0.0.1\"`.\r\n\r\n### <a name=\"attributes-persist-port\"></a> persist_port\r\n\r\nThe port number of the persistence service.\r\n\r\nThe default depends on which [persist_mode](#attributes-persist-mode) is\r\nselected:\r\n\r\n* `\"mongo\"`: the value set will be the value of `node['mongodb']['port']` if\r\n  set and falling back to `27017`.\r\n* `\"postgres\"`: the value set will be the value of\r\n  `node['postgresql']['config']['port']` if set and falling back to `5432`.\r\n\r\n### <a name=\"attributes-persist-username\"></a> persist_username\r\n\r\nThe username used when authenticating to the persistence service.\r\n\r\nThe default depends on which [persist_mode](#attributes-persist-mode) is\r\nselected:\r\n\r\n* `\"mongo\"`: a value is not set as the default localhost server does not\r\n  require authentication.\r\n* `\"postgres\"`: defaults to `\"razor\"`.\r\n\r\n### <a name=\"attributes-persist-password\"></a> persist_password\r\n\r\nThe password used when authenticating to the persistence service.\r\n\r\nThe default depends on which [persist_mode](#attributes-persist-mode) is\r\nselected:\r\n\r\n* `\"mongo\"`: a value is not set as the default localhost server does not\r\n  require authentication.\r\n* `\"postgres\"`: defaults to `\"project_razor\"`.\r\n\r\n**Note** do not rely on a default password if at all possible. Securing your\r\npersistence serivce with adequate password strength is your responsibility.\r\n\r\n### <a name=\"attributes-persist-timeout\"></a> persist_timeout\r\n\r\nThe connection timeout (in secondss) used when communicating with the\r\npersistence service.\r\n\r\nThe default is `10`.\r\n\r\n### <a name=\"attributes-mongo-local-server\"></a> mongo/local_server\r\n\r\nWhether or not to install a local MongoDB server on this node. If you want\r\nRazor to use an external MongoDB server then set this value to something\r\n\"untruthy\" such as `false` or `nil`.\r\n\r\nThe default depends on which [persist_mode](#attributes-persist-mode) is\r\nselected:\r\n\r\n* `\"mongo\"`: defaults to `true`.\r\n* `\"postgres\"`: defaults to `false`.\r\n\r\n### <a name=\"attributes-postgres-local-server\"></a> postgres/local_server\r\n\r\nWhether or not to install a local PostgreSQL server on this node. If you want\r\nRazor to use an external PostgreSQL server then set this value to something\r\n\"untruthy\" such as `false` or `nil`.\r\n\r\nThe default depends on which [persist_mode](#attributes-persist-mode) is\r\nselected:\r\n\r\n* `\"mongo\"`: defaults to `false`.\r\n* `\"postgres\"`: defaults to `true`.\r\n\r\n### <a name=\"attributes-images\"></a> images\r\n\r\nA Hash of Razor images to be added. The hash key will correspond to the image\r\n`name` attribute and the value will be a hash of other attributes to be fed\r\nto the [razor_image](#lwrps-image) LWRP. For example:\r\n\r\n    node['razor']['images'] = {\r\n      'razor-mk' => {\r\n        'type'    => 'mk',\r\n        'url'     => 'http://fdqn.com/razor-mk.iso',\r\n        'action'  => 'add'\r\n      },\r\n      'precise64' => {\r\n        'url'       => 'http://example.com/precise64.iso',\r\n        'checksum'  => 'abcabc...',\r\n        'version'   => '12.04'\r\n      }\r\n    }\r\n\r\nThe default is an empty hash: `Hash.new`.\r\n\r\n### <a name=\"attributes-ruby-system-packages\"></a> ruby_system_packages\r\n\r\nAn Array of system packages which will install the Ruby runtime. The\r\ndefaults are set automatically based on platform and platform\\_version but\r\ncan be overridden in needed.\r\n\r\n### <a name=\"attributes-npm-packages\"></a> npm_packages\r\n\r\nAn Array of npm packages to be installed. The defaults are set automatically\r\nbut can be overridden in needed.\r\n\r\n### <a name=\"attributes-install-path\"></a> install_path\r\n\r\nThe install base path of the Razor codebase.\r\n\r\nThe default is `\"/opt/razor\"`.\r\n\r\n### <a name=\"attributes-bundle-cmd\"></a> bundle_cmd\r\n\r\nThe bundle command which will be used to install Ruby gems.\r\n\r\nThe default is `\"bundle\"` (using `$PATH` lookup).\r\n\r\n### <a name=\"attributes-npm-cmd\"></a> npm_cmd\r\n\r\nThe npm command which will be used to install npm packages.\r\n\r\nThe default is `\"npm\"` (using `$PATH` lookup).\r\n\r\n### <a name=\"attributes-app-git-url\"></a> app/git_url\r\n\r\nThe Git URL for the Razor codebase.\r\n\r\nThe default is `\"https://github.com/puppetlabs/Razor.git\"`.\r\n\r\n### <a name=\"attributes-app-git-rev\"></a> app/git_rev\r\n\r\nThe Git reference/branch to check out.\r\n\r\nThe default is `\"0.9.0\"`. Valid values could be Git SHA hashes, branch names,\r\nand `\"master\"` for tracking development.\r\n\r\n### <a name=\"attributes-rubygems-source-version\"></a> rubygems_source/version\r\n\r\nThe version of Rubygems to be compiled (when necessary).\r\n\r\nThe default is `\"1.8.24\"`.\r\n\r\n### <a name=\"attributes-rubygems-source-url\"></a> rubygems_source/url\r\n\r\nThe URL containing Rubygems source which will be compiled (when necessary).\r\n\r\nThe default is set based on the Rubygems version attribute above.\r\n\r\n### <a name=\"attributes-mongodb-address\"></a> \\[deprecated\\] mongodb_address\r\n\r\nIP address which has a running MongoDB service.\r\n\r\nThe default is `\"127.0.0.1\"`.\r\n\r\n**Note** this value will set the [persist_host](#attributes-persist-host)\r\nattribute for backwards compatibility. This attribute will be removed in a 1.0\r\nrelease so please migrate to using `persist_host`.\r\n\r\n## <a name=\"lwrps\"></a> Resources and Providers\r\n\r\n### <a name=\"lwrps-image\"></a> razor_image\r\n\r\n#### <a name=\"lwrps-image-actions\"></a> Actions\r\n\r\n<table>\r\n  <thead>\r\n    <tr>\r\n      <th>Action</th>\r\n      <th>Description</th>\r\n      <th>Default</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr>\r\n      <td>add</td>\r\n      <td>Add the microkernel or operating system image to razor.</td>\r\n      <td>Yes</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n#### <a name=\"lwrps-image-attributes\"></a> Attributes\r\n\r\n<table>\r\n  <thead>\r\n    <tr>\r\n      <th>Attribute</th>\r\n      <th>Description</th>\r\n      <th>Default Value</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr>\r\n      <td>name</td>\r\n      <td>\r\n        <b>Name attribute:</b> The logical name to use for the image.\r\n      </td>\r\n      <td><code>nil</code></td>\r\n    </tr>\r\n    <tr>\r\n      <td>type</td>\r\n      <td>\r\n        The type of image. Valid values are <code>\"mk\"</code> for micro kernel\r\n        images and <code>\"os\"</code> for operating system images.\r\n      </td>\r\n      <td><code>\"os\"</code></td>\r\n    </tr>\r\n    <tr>\r\n      <td>url</td>\r\n      <td>\r\n        HTTP URL containing the image ISO.\r\n      </td>\r\n      <td><code>nil</code></td>\r\n    </tr>\r\n    <tr>\r\n      <td>version</td>\r\n      <td>\r\n        The version to use for <code>\"os\"</code> images only.\r\n      </td>\r\n      <td><code>nil</code></td>\r\n    </tr>\r\n    <tr>\r\n      <td>checksum</td>\r\n      <td>\r\n        An optional SHA-256 checksum for the ISO (for added verification).\r\n      </td>\r\n      <td><code>nil</code></td>\r\n    </tr>\r\n    <tr>\r\n      <td>iso_path</td>\r\n      <td>\r\n        An optional path where the downloaded ISO image will be stored before\r\n        being added to Razor. If no value is provided a path inside the\r\n        <code>Chef::Config[:file_cache_path]</code> will be computed.\r\n      </td>\r\n      <td><code>nil</code></td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n#### <a name=\"lwrps-image-examples\"></a> Examples\r\n\r\n##### Adding A Micro Kernel Image\r\n\r\n    razor_image \"rz_mk_prod-image.0.9.1.6\" do\r\n      type      \"mk\"\r\n      url       \"http://mirror.example.com/images/rz_mk_prod-image.0.9.1.6.iso\"\r\n      checksum  \"aljdflkjflajkf...\"\r\n      action    :add\r\n    end\r\n\r\n    razor_image \"rz_mk_prod-image.0.9.1.6\" do\r\n      type  \"mk\"\r\n      url   \"http://mirror.example.com/images/rz_mk_prod-image.0.9.1.6.iso\"\r\n    end\r\n\r\n**Note:** the add action is default, so the second example is a more common\r\nusage.\r\n\r\n##### Adding An Operating System Image\r\n\r\n    razor_image \"precise64\" do\r\n      type      \"os\"\r\n      url       \"http://mirror.example.com/images/ubuntu-amd64-12.04.iso\"\r\n      checksum  \"lkjdfoidadba...\"\r\n      version   \"12.04\"\r\n      iso_path  \"/data/razor_images\"\r\n    end\r\n\r\n    razor_image \"sl64-6.3\" do\r\n      url     \"http://mirror.example.com/images/scientific-amd64-6.3.iso\"\r\n      version 6.3\r\n    end\r\n\r\n**Note:** the default for type is `\"os\"` so this can be omitted in most cases.\r\nThe version attribute can also be a Float.\r\n\r\n## <a name=\"development\"></a> Development\r\n\r\n* Source hosted at [GitHub][repo]\r\n* Report issues/Questions/Feature requests on [GitHub Issues][issues]\r\n\r\nPull requests are very welcome! Make sure your patches are well tested.\r\nIdeally create a topic branch for every separate change you make.\r\n\r\n## <a name=\"license\"></a> License and Author\r\n\r\nAuthor:: [Fletcher Nichol][fnichol] (<fnichol@nichol.ca>)\r\n\r\nCopyright 2012, Blue Box Group, LLC\r\n\r\nLicensed under the Apache License, Version 2.0 (the \"License\");\r\nyou may not use this file except in compliance with the License.\r\nYou may obtain a copy of the License at\r\n\r\n    http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing, software\r\ndistributed under the License is distributed on an \"AS IS\" BASIS,\r\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\nSee the License for the specific language governing permissions and\r\nlimitations under the License.\r\n\r\n[berkshelf]:    http://berkshelf.com/\r\n[build_essential_cb]: http://community.opscode.com/cookbooks/build-essential\r\n[chef_repo]:    https://github.com/opscode/chef-repo\r\n[cheffile]:     https://github.com/applicationsonline/librarian/blob/master/lib/librarian/chef/templates/Cheffile\r\n[git_cb]:       http://community.opscode.com/cookbooks/git\r\n[kgc]:          https://github.com/websterclay/knife-github-cookbooks#readme\r\n[librarian]:    https://github.com/applicationsonline/librarian#readme\r\n[mongodb_cb]:   http://community.opscode.com/cookbooks/mongodb\r\n[nodejs_cb]:    http://community.opscode.com/cookbooks/nodejs\r\n[postgresql_cb]: http://community.opscode.com/cookbooks/postgresql\r\n[razor_site]:   https://github.com/puppetlabs/Razor\r\n[tftp_cb]:      http://community.opscode.com/cookbooks/tftp\r\n\r\n[fnichol]:      https://github.com/fnichol\r\n[repo]:         https://github.com/bbg-cookbooks/razor\r\n[issues]:       https://github.com/bbg-cookbooks/razor/issues\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}